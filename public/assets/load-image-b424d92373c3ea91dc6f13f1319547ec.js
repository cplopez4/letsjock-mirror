(function(e){"use strict";var t=function(e,n,r){var i,s,o=document.createElement("img");if(o.onerror=n,o.onload=function(){!s||r&&r.noRevoke||t.revokeObjectURL(s),n&&n(t.scale(o,r))},t.isInstanceOf("Blob",e)||t.isInstanceOf("File",e))i=s=t.createObjectURL(e),o._type=e.type;else{if("string"!=typeof e)return!1;i=e,r&&r.crossOrigin&&(o.crossOrigin=r.crossOrigin)}return i?(o.src=i,o):t.readFile(e,function(e){var t=e.target;t&&t.result?o.src=t.result:n&&n(e)})},n=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.isInstanceOf=function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},t.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-e.width+1,0),0===n.getImageData(0,0,1,1).data[3]):!1},t.detectVerticalSquash=function(e,t){var n,r,i,s,o,u=document.createElement("canvas"),a=u.getContext("2d");for(u.width=1,u.height=t,a.drawImage(e,0,0),n=a.getImageData(0,0,1,t).data,r=0,i=t,s=t;s>r;)o=n[4*(s-1)+3],0===o?i=s:r=s,s=i+r>>1;return s/t||1},t.renderImageToCanvas=function(e,n,r,i,s,o,u,a,f,l){var c,h,p,d=e.getContext("2d"),v=document.createElement("canvas"),m=v.width=v.height=1024,g=v.getContext("2d");for(d.save(),t.detectSubsampling(n)&&(s/=2,o/=2),c=t.detectVerticalSquash(n,o),f=Math.ceil(m*f/s),l=Math.ceil(m*l/o/c),a=0,p=0;o>p;){for(u=0,h=0;s>h;)g.clearRect(0,0,m,m),g.drawImage(n,r,i,s,o,-h,-p,s,o),d.drawImage(v,0,0,m,m,u,a,f,l),h+=m,u+=f;p+=m,a+=l}d.restore()},t.scale=function(e,n){n=n||{};var r,i,s,o=document.createElement("canvas"),u=e.getContext||(n.canvas||n.crop)&&o.getContext,a=e.width,f=e.height,l=n.maxWidth,c=n.maxHeight,h=a,p=f,d=0,v=0,m=0,g=0;return u&&l&&c&&n.crop?(r=l,i=c,l/c>a/f?(p=c*a/l,v=(f-p)/2):(h=l*f/c,d=(a-h)/2)):(r=a,i=f,s=Math.max((n.minWidth||r)/r,(n.minHeight||i)/i),s>1&&(r=Math.ceil(r*s),i=Math.ceil(i*s)),s=Math.min((l||r)/r,(c||i)/i),1>s&&(r=Math.ceil(r*s),i=Math.ceil(i*s))),u?(o.width=r,o.height=i,"image/jpeg"===e._type?t.renderImageToCanvas(o,e,d,v,h,p,m,g,r,i):o.getContext("2d").drawImage(e,d,v,h,p,m,g,r,i),o):(e.width=r,e.height=i,e)},t.createObjectURL=function(e){return n?n.createObjectURL(e):!1},t.revokeObjectURL=function(e){return n?n.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var n=new FileReader;return n.onload=n.onerror=t,n.readAsDataURL(e),n}return!1},"function"==typeof define&&define.amd?define(function(){return t}):e.loadImage=t})(this);